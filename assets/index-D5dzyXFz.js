import{c as xe,a as ve,u as re,b as L,r as p,j as e,L as P,O as ke,R as O,d as b,M as I,e as Y,f as Q,N as K,g as we,h as Ce,H as $e,i as Ue,k as R,l as _e,P as Se}from"./vendor-B5Rr7hLC.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))t(c);new MutationObserver(c=>{for(const r of c)if(r.type==="childList")for(const x of r.addedNodes)x.tagName==="LINK"&&x.rel==="modulepreload"&&t(x)}).observe(document,{childList:!0,subtree:!0});function a(c){const r={};return c.integrity&&(r.integrity=c.integrity),c.referrerPolicy&&(r.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?r.credentials="include":c.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function t(c){if(c.ep)return;c.ep=!0;const r=a(c);fetch(c.href,r)}})();const qe={message:"",visible:!1},ue=xe({name:"toast",initialState:qe,reducers:{showToast:(n,o)=>{n.message=o.payload,n.visible=!0},hideToast:n=>{n.visible=!1}}}),{showToast:E,hideToast:ce}=ue.actions,Ae=ue.reducer,ie=[],je=xe({name:"cart",initialState:ie,reducers:{addToCart:(n,o)=>{const{product:a,quantity:t}=o.payload,c=n.find(r=>r.id===a.id);c?c.quantity+=t:n.push({...a,imageUrl:a.imageUrl||"",quantity:t})},removeFromCart:(n,o)=>{const a=o.payload;return n.filter(t=>t.id!==a)},updateCartItemQuantity:(n,o)=>{const{id:a,quantity:t}=o.payload,c=n.find(r=>r.id===a);c&&(c.quantity=t)},clearCart:()=>ie}}),{addToCart:B,removeFromCart:oe,updateCartItemQuantity:de,clearCart:W}=je.actions,Fe=je.reducer,Ie=ve({reducer:{toast:Ae,cart:Fe}});function G(){const{message:n,visible:o}=re(r=>r.toast),a=L();if(p.useEffect(()=>{if(o){const r=setTimeout(()=>{a(ce())},5e3);return()=>clearTimeout(r)}},[o,a]),!o)return null;const c=n.includes("移除")?"toast-header bg-danger text-white":"toast-header bg-success text-white";return e.jsx("div",{className:"position-fixed top-0 end-0 p-3",style:{zIndex:1500},children:e.jsxs("div",{className:"toast show",role:"alert","aria-live":"assertive","aria-atomic":"true",style:{opacity:1,backgroundColor:"#fff",boxShadow:"0 0.5rem 1rem rgba(0, 0, 0, 0.15)"},children:[e.jsxs("div",{className:c,children:[e.jsx("strong",{className:"me-auto",children:"通知"}),e.jsx("button",{type:"button",className:"btn-close","aria-label":"Close",onClick:()=>a(ce())})]}),e.jsx("div",{className:"toast-body",children:n})]})})}const Me=()=>e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-body-tertiary",children:[e.jsx("nav",{className:"navbar navbar-expand-lg container",children:e.jsxs("div",{className:"container-fluid",children:[e.jsx("a",{className:"navbar-brand fw-bold",href:"https://chrisc0210.github.io/react-training-2025/#/",children:"REACT TRAINING"}),e.jsx("button",{className:"navbar-toggler",type:"button","data-bs-toggle":"collapse","data-bs-target":"#navbarText","aria-controls":"navbarText","aria-expanded":"false","aria-label":"Toggle navigation",children:e.jsx("span",{className:"navbar-toggler-icon"})}),e.jsx("div",{className:"collapse navbar-collapse",id:"navbarText",children:e.jsxs("ul",{className:"navbar-nav me-auto mb-2 mb-lg-0",children:[e.jsx("li",{className:"nav-item",children:e.jsx(P,{className:"nav-link active",to:"/",children:"Home"})}),e.jsx("li",{className:"nav-item",children:e.jsx(P,{className:"nav-link",to:"https://chrisc0210.github.io/ReactWeek1/",children:"Week1"})}),e.jsx("li",{className:"nav-item",children:e.jsx(P,{className:"nav-link",to:"/week2",children:"Week2"})}),e.jsx("li",{className:"nav-item",children:e.jsx(P,{className:"nav-link",to:"/week3",children:"Week3"})}),e.jsx("li",{className:"nav-item",children:e.jsx(P,{className:"nav-link",to:"/week4",children:"Week4"})}),e.jsx("li",{className:"nav-item",children:e.jsx(P,{className:"nav-link",to:"/week5",children:"Week5"})}),e.jsx("li",{className:"nav-item",children:e.jsx(P,{className:"nav-link",to:"/week6",children:"Week6"})}),e.jsx("li",{className:"nav-item",children:e.jsx(P,{className:"nav-link",to:"/week7",children:"Week7"})})]})})]})}),e.jsx(G,{})]}),e.jsx(ke,{})]}),Ee=()=>e.jsxs("div",{className:"container mt-5",children:[e.jsx("h1",{children:"Welcome to the Home Page"}),e.jsx("p",{children:"This is the home page of our application."})]});function Pe(){const[n,o]=O.useState(null),[a,t]=O.useState([]),[c,r]=p.useState(!1),[x,i]=p.useState({username:"",password:""}),f=u=>{const{value:k,name:C}=u.target;i({...x,[C]:k})},j=u=>{u.preventDefault(),console.log(x),b.post("https://ec-course-api.hexschool.io/v2/admin/signin",x).then(k=>{const{token:C,expired:q}=k.data;console.log(C,q),document.cookie=`hexToken=${C}; expires=${new Date(q)}`,b.defaults.headers.common.Authorization=C,k.data.success===!0&&(alert("登入成功"),b.get("https://ec-course-api.hexschool.io/v2/api/product-backend/admin/products").then(U=>{console.log(U.data),t(U.data.products)}).catch(U=>{console.error(U)}),r(!0))}).catch(k=>{console.error(k),alert("登入失敗"),r(!1)})};return e.jsx(e.Fragment,{children:c?e.jsx("section",{className:"container mt-5",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-12 col-lg-6 mb-4",children:[e.jsx("h2",{className:"fw-bold",children:"產品列表"}),e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"產品名稱"}),e.jsx("th",{children:"原價"}),e.jsx("th",{children:"售價"}),e.jsx("th",{children:"是否啟用"}),e.jsx("th",{children:"查看細節"})]})}),e.jsx("tbody",{children:a.map(u=>e.jsxs("tr",{children:[e.jsx("td",{className:"fw-bold",children:u.title}),e.jsx("td",{children:u.origin_price}),e.jsx("td",{children:u.price}),e.jsx("td",{children:u.is_enabled?"是":"否"}),e.jsx("td",{children:e.jsx("button",{className:"btn btn-primary",onClick:()=>{o(u)},children:"查看細節"})})]},u.id))})]})]}),e.jsxs("div",{className:"col-12 col-lg-6 mb-4",children:[e.jsx("h2",{className:"fw-bold",children:"單一產品細節"}),n&&n.title?e.jsxs("div",{className:"card mb-3",children:[e.jsx("img",{src:n.imageUrl,className:"card-img-top primary-image",alt:"主圖"}),e.jsxs("div",{className:"card-body",children:[e.jsxs("h5",{className:"card-title",children:[n.title,e.jsx("span",{className:"badge bg-primary ms-2",children:n.category})]}),e.jsxs("p",{className:"card-text",children:["商品描述：",n.description]}),e.jsxs("p",{className:"card-text",children:["商品內容：",n.content]}),e.jsxs("div",{className:"d-flex",children:[e.jsx("p",{className:"card-text text-secondary",children:e.jsx("del",{children:n.origin_price})}),"元 / ",n.price," 元"]}),e.jsx("h5",{className:"mt-3",children:"更多圖片："}),e.jsx("div",{className:"d-flex flex-wrap",children:n.imagesUrl.map((u,k)=>e.jsx("img",{src:u,className:"img-thumbnail border-0 me-2",alt:"其他圖片"},k))})]})]}):e.jsx("p",{className:"text-secondary fw-bold",children:"請選擇一個商品查看 !"})]})]})}):e.jsx("section",{className:"bg-gradient",children:e.jsxs("div",{className:"d-flex flex-column justify-content-center align-items-center vh-100",children:[e.jsx("h1",{className:"mb-5",children:"請先登入"}),e.jsxs("form",{className:"d-flex flex-column gap-4 w-50 p-4 shadow rounded-3",children:[e.jsxs("div",{className:"form-floating mb-3",children:[e.jsx("input",{type:"email",className:"form-control",id:"username",placeholder:"name@example.com",value:x.username,name:"username",onChange:f}),e.jsx("label",{htmlFor:"username",children:"Email address"})]}),e.jsxs("div",{className:"form-floating",children:[e.jsx("input",{type:"password",className:"form-control",id:"password",placeholder:"Password",value:x.password,name:"password",onChange:f}),e.jsx("label",{htmlFor:"password",children:"Password"})]}),e.jsx("button",{className:"btn btn-primary",onClick:j,children:"登入"})]}),e.jsx("p",{className:"mt-5 mb-3 text-muted",children:"© 2025 Chris Chen"})]})})})}function Te(){const n="https://ec-course-api.hexschool.io",o="/product-backend",a={id:"",imageUrl:"",title:"",category:"",unit:"",origin_price:"",price:"",description:"",content:"",is_enabled:0,imagesUrl:[]},[t,c]=p.useState(a),[r,x]=p.useState("create"),[i,f]=O.useState([]),[j,u]=p.useState(!1),[k,C]=p.useState({username:"",password:""}),q=m=>{const{value:g,name:w}=m.target;C({...k,[w]:g})},U=async()=>{try{const m=await b.get(`${n}/v2/api${o}/admin/products`);f(m.data.products)}catch(m){alert("取得產品失敗"),console.error(m)}},v=async m=>{m.preventDefault();try{const g=await b.post("https://ec-course-api.hexschool.io/v2/admin/signin",k),{token:w,expired:T}=g.data;document.cookie=`hexToken=${w}; expires=${new Date(T)}`,b.defaults.headers.common.Authorization=w,g.data.success===!0&&(alert("登入成功"),await U(),u(!0))}catch(g){alert(`登入失敗: ${g.message||"請檢查帳號密碼是否正確"}`),u(!1)}},d=async()=>{try{await b.post(`${n}/v2/api/user/check`),U(),u(!0)}catch(m){console.error(m)}};p.useEffect(()=>{const m=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1");b.defaults.headers.common.Authorization=m,d()},[]);const y=p.useRef(null),$=p.useRef(null);p.useEffect(()=>{new I(y.current),new I($.current)},[]);const _=(m,g)=>{x(m),c(g?{id:g.id.toString(),imageUrl:g.imageUrl||"",title:g.title,category:g.category,unit:g.unit,origin_price:g.origin_price.toString(),price:g.price.toString(),description:g.description,content:g.content,is_enabled:g.is_enabled,imagesUrl:g.imagesUrl.length>0?g.imagesUrl:[]}:a);const w=I.getInstance(y.current);w&&w.show()},M=m=>{c({id:m.id.toString(),imageUrl:m.imageUrl,title:m.title,category:m.category,unit:"",origin_price:m.origin_price.toString(),price:m.price.toString(),description:m.description,content:m.content,is_enabled:m.is_enabled,imagesUrl:m.imagesUrl});const g=I.getInstance($.current);g&&g.show()},A=()=>{const m=I.getInstance(y.current);m&&m.hide(),c(a)},F=()=>{const m=I.getInstance($.current);m&&m.hide(),c(a)},s=m=>{const{value:g,name:w,type:T}=m.target,H=m.target.checked;c(ye=>({...ye,[w]:T==="checkbox"?H:g}))},l=(m,g)=>{const{value:w}=m.target;c(T=>{const H=[...T.imagesUrl];return H[g]=w,{...T,imagesUrl:H}})},N=()=>{c(m=>({...m,imagesUrl:[...m.imagesUrl,""]}))},h=()=>{c(m=>({...m,imagesUrl:m.imagesUrl.slice(0,m.imagesUrl.length-1)}))},S=async()=>{var m,g;try{return await b.post(`${n}/v2/api${o}/admin/product`,{data:{...t,origin_price:Number(t.origin_price),price:Number(t.price),is_enabled:t.is_enabled?1:0}}),{success:!0,message:"新增成功"}}catch(w){return{success:!1,message:`新增失敗: ${((g=(m=w.response)==null?void 0:m.data)==null?void 0:g.message)||"發生未知錯誤"}`}}},J=async()=>{var m,g;try{return await b.put(`${n}/v2/api${o}/admin/product/${t.id}`,{data:{...t,origin_price:Number(t.origin_price),price:Number(t.price),is_enabled:t.is_enabled?1:0}}),{success:!0,message:"更新成功"}}catch(w){return{success:!1,message:`更新失敗: ${((g=(m=w.response)==null?void 0:m.data)==null?void 0:g.message)||"發生未知錯誤"}`}}},ge=async()=>{const g=await(r==="create"?S:J)();g.success?(await U(),A()):alert(g.message)},Ne=async()=>{var m,g;try{return await b.delete(`${n}/v2/api${o}/admin/product/${t.id}`),{success:!0,message:"刪除成功"}}catch(w){return{success:!1,message:`刪除失敗: ${((g=(m=w.response)==null?void 0:m.data)==null?void 0:g.message)||"發生未知錯誤"}`}}},fe=async()=>{const m=await Ne();m.success?(await U(),F()):alert(m.message)};return e.jsxs(e.Fragment,{children:[j?e.jsx("section",{className:"container mt-5",children:e.jsx("div",{className:"row",children:e.jsxs("div",{className:"col-12 mb-4",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("h2",{className:"fw-bold",children:"產品列表"}),e.jsxs("button",{onClick:()=>{_("create")},type:"button",className:"btn btn-primary",children:[e.jsx("i",{className:"bi  bi-plus-lg"})," 建立新的產品"]})]}),e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"產品名稱"}),e.jsx("th",{children:"原價"}),e.jsx("th",{children:"售價"}),e.jsx("th",{children:"是否啟用"}),e.jsx("th",{children:"查看細節"})]})}),e.jsx("tbody",{children:i.map(m=>e.jsxs("tr",{children:[e.jsx("td",{className:"fw-bold",children:m.title}),e.jsx("td",{children:m.origin_price}),e.jsx("td",{children:m.price}),e.jsx("td",{children:m.is_enabled?e.jsx("span",{className:"text-success",children:"啟用"}):e.jsx("span",{className:"text-danger",children:"未啟用"})}),e.jsx("td",{children:e.jsxs("div",{className:"",children:[e.jsxs("button",{onClick:()=>{const g=i.find(w=>w.id===m.id);g&&_("edit",g)},type:"button",className:"btn btn-primary btn-sm me-2",children:[e.jsx("i",{className:"bi bi-pencil-square"})," 編輯"]}),e.jsxs("button",{onClick:()=>{const g=i.find(w=>w.id===m.id);g&&M(g)},type:"button",className:"btn btn-danger btn-sm",children:[e.jsx("i",{className:"bi bi-trash3-fill"})," 刪除"]})]})})]},m.id))})]})]})})}):e.jsx("section",{className:"bg-gradient",children:e.jsxs("div",{className:"d-flex flex-column justify-content-center align-items-center vh-100",children:[e.jsx("h1",{className:"mb-5",children:"請先登入"}),e.jsxs("form",{className:"d-flex flex-column gap-4 w-50 p-4 shadow rounded-3",children:[e.jsxs("div",{className:"form-floating mb-3",children:[e.jsx("input",{type:"email",className:"form-control",id:"username",placeholder:"name@example.com",value:k.username,name:"username",onChange:q}),e.jsx("label",{htmlFor:"username",children:"Email address"})]}),e.jsxs("div",{className:"form-floating",children:[e.jsx("input",{type:"password",className:"form-control",id:"password",placeholder:"Password",value:k.password,name:"password",onChange:q}),e.jsx("label",{htmlFor:"password",children:"Password"})]}),e.jsx("button",{className:"btn btn-primary",onClick:v,children:"登入"})]}),e.jsx("p",{className:"mt-5 mb-3 text-muted",children:"© 2025 Chris Chen"})]})}),e.jsx("div",{ref:y,id:"productModal",className:"modal",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:e.jsx("div",{className:"modal-dialog modal-dialog-centered modal-xl",children:e.jsxs("div",{className:"modal-content border-0 shadow",children:[e.jsxs("div",{className:"modal-header border-bottom",children:[e.jsx("h5",{className:"modal-title fs-4",children:r==="create"?"新增產品":"編輯產品"}),e.jsx("button",{onClick:A,type:"button",className:"btn-close","aria-label":"Close"})]}),e.jsx("div",{className:"modal-body p-4",children:e.jsxs("div",{className:"row g-4",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"primary-image",className:"form-label",children:"主要圖片"}),e.jsx("div",{className:"input-group",children:e.jsx("input",{value:t.imageUrl,onChange:m=>s(m),name:"imageUrl",type:"text",id:"primary-image",className:"form-control",placeholder:"請輸入圖片連結"})}),t.imageUrl?e.jsx("img",{src:t.imageUrl,alt:t.title,className:"img-fluid"}):e.jsx("div",{className:"text-muted",children:"尚無圖片"})]}),e.jsxs("div",{className:"border border-2 border-dashed rounded-3 p-3",children:[t.imagesUrl.map((m,g)=>e.jsxs("div",{className:"mb-2",children:[e.jsxs("label",{htmlFor:`imagesUrl-${g+1}`,className:"form-label",children:["其他圖片 ",g+1]}),e.jsx("input",{value:m,onChange:w=>l(w,g),id:`imagesUrl-${g+1}`,type:"text",placeholder:`圖片網址 ${g+1}`,className:"form-control mb-2"}),t.imagesUrl.length>0&&t.imagesUrl.some(w=>w)?t.imagesUrl.map((w,T)=>w?e.jsx("img",{src:w,alt:`副圖 ${T+1}`,className:"img-fluid"},T):null):e.jsx("div",{className:"text-muted",children:"無附圖"})]},g)),e.jsxs("div",{className:"btn-group w-100",children:[t.imagesUrl.length<5&&t.imagesUrl[t.imagesUrl.length-1]!==""&&e.jsx("button",{className:"btn btn-outline-primary btn-sm w-100",onClick:()=>N(),children:"新增圖片"}),t.imagesUrl.length>1&&e.jsx("button",{className:"btn btn-outline-danger btn-sm w-100",onClick:()=>h(),children:"取消圖片"})]})]})]}),e.jsxs("div",{className:"col-md-8",children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{htmlFor:"title",className:"form-label",children:["標題",t.id]}),e.jsx("input",{value:t.title,onChange:s,name:"title",id:"title",type:"text",className:"form-control",placeholder:"請輸入標題"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"category",className:"form-label",children:"分類"}),e.jsx("input",{value:t.category,onChange:s,name:"category",id:"category",type:"text",className:"form-control",placeholder:"請輸入分類"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"unit",className:"form-label",children:"單位"}),e.jsx("input",{value:t.unit,onChange:s,name:"unit",id:"unit",type:"text",className:"form-control",placeholder:"請輸入單位"})]}),e.jsxs("div",{className:"row g-3 mb-3",children:[e.jsxs("div",{className:"col-6",children:[e.jsx("label",{htmlFor:"origin_price",className:"form-label",children:"原價"}),e.jsx("input",{value:t.origin_price,onChange:s,name:"origin_price",id:"origin_price",type:"number",min:"0",className:"form-control",placeholder:"請輸入原價"})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("label",{htmlFor:"price",className:"form-label",children:"售價"}),e.jsx("input",{value:t.price,onChange:s,name:"price",id:"price",type:"number",min:"0",className:"form-control",placeholder:"請輸入售價"})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"description",className:"form-label",children:"產品描述"}),e.jsx("textarea",{value:t.description,onChange:s,name:"description",id:"description",className:"form-control",rows:4,placeholder:"請輸入產品描述"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"content",className:"form-label",children:"說明內容"}),e.jsx("textarea",{value:t.content,onChange:s,name:"content",id:"content",className:"form-control",rows:4,placeholder:"請輸入說明內容"})]}),e.jsxs("div",{className:"form-check",children:[e.jsx("input",{checked:!!t.is_enabled,onChange:s,name:"is_enabled",type:"checkbox",className:"form-check-input",id:"isEnabled"}),e.jsx("label",{className:"form-check-label",htmlFor:"isEnabled",children:"是否啟用"})]})]})]})}),e.jsxs("div",{className:"modal-footer border-top bg-light",children:[e.jsx("button",{onClick:A,type:"button",className:"btn btn-secondary",children:"取消"}),e.jsx("button",{onClick:ge,type:"button",className:"btn btn-primary",children:"確認"})]})]})})}),e.jsx("div",{ref:$,id:"delProductModal",className:"modal fade",tabIndex:-1,style:{backgroundColor:"rgba(0,0,0,0.5)"},children:e.jsx("div",{className:"modal-dialog",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h1",{className:"modal-title fs-5",children:"刪除產品"}),e.jsx("button",{onClick:F,type:"button",className:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})]}),e.jsxs("div",{className:"modal-body",children:["你是否要刪除 ",e.jsxs("span",{className:"text-danger fw-bold",children:[t.title,"?"]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{onClick:F,type:"button",className:"btn btn-secondary",children:"取消"}),e.jsx("button",{onClick:fe,type:"button",className:"btn btn-danger",children:"刪除"})]})]})})})]})}const pe=({handleLogin:n})=>{const[o,a]=p.useState({username:"",password:""}),t=r=>{const{name:x,value:i}=r.target;a(f=>({...f,[x]:i}))},c=r=>{r.preventDefault(),n(o.username,o.password)};return e.jsx(e.Fragment,{children:e.jsx("section",{className:"bg-gradient",children:e.jsxs("div",{className:"d-flex flex-column justify-content-center align-items-center vh-100",children:[e.jsx("h1",{className:"mb-5",children:"請先登入"}),e.jsxs("form",{className:"d-flex flex-column gap-4 w-50 p-4 shadow rounded-3",children:[e.jsxs("div",{className:"form-floating mb-3",children:[e.jsx("input",{type:"email",className:"form-control",id:"username",placeholder:"name@example.com",value:o.username,name:"username",onChange:t}),e.jsx("label",{htmlFor:"username",children:"Email address"})]}),e.jsxs("div",{className:"form-floating",children:[e.jsx("input",{type:"password",className:"form-control",id:"password",placeholder:"Password",value:o.password,name:"password",onChange:t}),e.jsx("label",{htmlFor:"password",children:"Password"})]}),e.jsx("button",{className:"btn btn-primary",onClick:c,children:"登入"})]}),e.jsx("p",{className:"mt-5 mb-3 text-muted",children:"© 2025 Chris Chen"})]})})})},Re=({tempProduct:n,setTempProduct:o,modalMode:a,closeProductModal:t,handleUploadProduct:c,productModalRef:r,BASE_URL:x,API_PATH:i})=>{const[,f]=p.useState(0),j=async v=>{var _;const y=(_=v.target.files)==null?void 0:_[0];if(!y){alert("請選擇圖片檔案");return}const $=new FormData;$.append("file-to-upload",y);try{const A=(await b.post(`${x}/v2/api${i}/admin/upload`,$,{headers:{"Content-Type":"multipart/form-data"}})).data.imageUrl;o(F=>({...F,imageUrl:A})),f(F=>F+1)}catch(M){console.error(M),alert("圖片上傳失敗")}},u=v=>{const{value:d,name:y,type:$}=v.target,_=v.target.checked;o(M=>({...M,[y]:$==="checkbox"?_:d}))},k=(v,d)=>{const{value:y}=v.target;o($=>{const _=[...$.imagesUrl];return _[d]=y,{...$,imagesUrl:_}})},C=()=>{o(v=>({...v,imagesUrl:[...v.imagesUrl,""]}))},q=()=>{o(v=>({...v,imagesUrl:v.imagesUrl.slice(0,v.imagesUrl.length-1)}))},U=async(v,d)=>{var M;const $=(M=v.target.files)==null?void 0:M[0];if(!$){alert("請選擇圖片檔案");return}const _=new FormData;_.append("file-to-upload",$);try{const A=await b.post(`${x}/v2/api${i}/admin/upload`,_,{headers:{"Content-Type":"multipart/form-data"}});console.log(`副圖片上傳成功: ${A.data.imageUrl}`),o(F=>{const s=[...F.imagesUrl];return s[d]=A.data.imageUrl,{...F,imagesUrl:s}})}catch(A){console.error("副圖片上傳失敗:",A),alert("副圖片上傳失敗")}};return e.jsx(e.Fragment,{children:e.jsx("div",{ref:r,id:"productModal",className:"modal",style:{backgroundColor:"rgba(0,0,0,0.5)"},children:e.jsx("div",{className:"modal-dialog modal-dialog-centered modal-xl",children:e.jsxs("div",{className:"modal-content border-0 shadow",children:[e.jsxs("div",{className:"modal-header border-bottom",children:[e.jsx("h5",{className:"modal-title fs-4",children:a==="create"?"新增產品":"編輯產品"}),e.jsx("button",{onClick:t,type:"button",className:"btn-close","aria-label":"Close"})]}),e.jsxs("div",{className:"modal-body p-4",children:[e.jsxs("div",{className:"row g-4",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsxs("div",{className:"mb-5",children:[e.jsx("label",{htmlFor:"fileInput",className:"form-label",children:" 圖片上傳 "}),e.jsx("input",{type:"file",accept:".jpg,.jpeg,.png",className:"form-control",id:"fileInput",onClick:j})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"primary-image",className:"form-label",children:"主要圖片"}),e.jsx("div",{className:"input-group",children:e.jsx("input",{value:n.imageUrl,onChange:v=>u(v),name:"imageUrl",type:"text",id:"primary-image",className:"form-control",placeholder:"請輸入圖片連結"})}),n.imageUrl?e.jsx("img",{src:n.imageUrl,alt:n.title,className:"img-fluid"}):e.jsx("div",{className:"text-muted",children:"尚無圖片"})]}),e.jsxs("div",{className:"border border-2 border-dashed rounded-3 p-3",children:[n.imagesUrl.map((v,d)=>e.jsxs("div",{className:"mb-2",children:[e.jsxs("label",{htmlFor:`imagesUrl-${d+1}`,className:"form-label",children:["其他圖片 ",d+1]}),e.jsx("input",{type:"file",accept:".jpg,.jpeg,.png",className:"form-control mb-2",id:`fileInput-${d}`,onChange:y=>U(y,d)}),e.jsx("input",{value:v,onChange:y=>k(y,d),id:`imagesUrl-${d+1}`,type:"text",placeholder:`圖片網址 ${d+1}`,className:"form-control mb-2"}),v?e.jsx("img",{src:v,alt:`副圖 ${d+1}`,className:"img-fluid"}):e.jsx("div",{className:"text-muted",children:"尚無圖片"})]},d)),e.jsxs("div",{className:"btn-group w-100",children:[n.imagesUrl.length<5&&n.imagesUrl[n.imagesUrl.length-1]!==""&&e.jsx("button",{className:"btn btn-outline-primary btn-sm w-100",onClick:()=>C(),children:"新增圖片"}),n.imagesUrl.length>1&&e.jsx("button",{className:"btn btn-outline-danger btn-sm w-100",onClick:()=>q(),children:"取消圖片"})]})]})]}),e.jsxs("div",{className:"col-md-8",children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("label",{htmlFor:"title",className:"form-label",children:["標題",n.id]}),e.jsx("input",{value:n.title,onChange:u,name:"title",id:"title",type:"text",className:"form-control",placeholder:"請輸入標題"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"category",className:"form-label",children:"分類"}),e.jsx("input",{value:n.category,onChange:u,name:"category",id:"category",type:"text",className:"form-control",placeholder:"請輸入分類"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"unit",className:"form-label",children:"單位"}),e.jsx("input",{value:n.unit,onChange:u,name:"unit",id:"unit",type:"text",className:"form-control",placeholder:"請輸入單位"})]}),e.jsxs("div",{className:"row g-3 mb-3",children:[e.jsxs("div",{className:"col-6",children:[e.jsx("label",{htmlFor:"origin_price",className:"form-label",children:"原價"}),e.jsx("input",{value:n.origin_price,onChange:u,name:"origin_price",id:"origin_price",type:"number",className:"form-control",placeholder:"請輸入原價"})]}),e.jsxs("div",{className:"col-6",children:[e.jsx("label",{htmlFor:"price",className:"form-label",children:"售價"}),e.jsx("input",{value:n.price,onChange:u,name:"price",id:"price",type:"number",className:"form-control",placeholder:"請輸入售價"})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"description",className:"form-label",children:"產品描述"}),e.jsx("textarea",{value:n.description,onChange:u,name:"description",id:"description",className:"form-control",rows:4,placeholder:"請輸入產品描述"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"content",className:"form-label",children:"說明內容"}),e.jsx("textarea",{value:n.content,onChange:u,name:"content",id:"content",className:"form-control",rows:4,placeholder:"請輸入說明內容"})]}),e.jsxs("div",{className:"form-check",children:[e.jsx("input",{checked:!!n.is_enabled,onChange:u,name:"is_enabled",type:"checkbox",className:"form-check-input",id:"isEnabled"}),e.jsx("label",{className:"form-check-label",htmlFor:"isEnabled",children:"是否啟用"})]})]})]}),e.jsxs("div",{className:"col-md-12",children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"rating",className:"form-label",children:"商品評價星級 (1~5)"}),e.jsx("input",{value:n.rating??0,onChange:v=>o(d=>({...d,rating:Number(v.target.value)})),type:"number",min:"1",max:"5",className:"form-control",placeholder:"請輸入評價星級"})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"stock",className:"form-label",children:"庫存數量"}),e.jsx("input",{value:n.stock??0,onChange:v=>o(d=>({...d,stock:Number(v.target.value)})),type:"number",min:"0",className:"form-control",placeholder:"請輸入庫存數量"})]})]})]}),e.jsxs("div",{className:"modal-footer border-top bg-light",children:[e.jsx("button",{onClick:t,type:"button",className:"btn btn-secondary",children:"取消"}),e.jsx("button",{onClick:c,type:"button",className:"btn btn-primary",children:"確認"})]})]})})})})},He=({pageInfo:n,handlePageChange:o})=>{const{total_pages:a,current_page:t,has_pre:c,has_next:r}=n;return e.jsx("nav",{children:e.jsxs("ul",{className:"pagination",children:[e.jsx("li",{className:`page-item ${c?"":"disabled"}`,children:e.jsx("button",{onClick:()=>c&&o(t-1),className:"page-link",disabled:!c,children:"上一頁"})}),Array.from({length:a},(x,i)=>e.jsx("li",{className:`page-item ${t===i+1?"active":""}`,children:e.jsx("button",{onClick:()=>o(i+1),className:"page-link",children:i+1})},i)),e.jsx("li",{className:`page-item ${r?"":"disabled"}`,children:e.jsx("button",{onClick:()=>r&&o(t+1),className:"page-link",disabled:!r,children:"下一頁"})})]})})},Le=({tempProduct:n,closeDelProductModal:o,handleDelProduct:a,delProductModalRef:t})=>e.jsx(e.Fragment,{children:e.jsx("div",{ref:t,id:"delProductModal",className:"modal fade",tabIndex:-1,style:{backgroundColor:"rgba(0,0,0,0.5)"},children:e.jsx("div",{className:"modal-dialog",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsx("h1",{className:"modal-title fs-5",children:"刪除產品"}),e.jsx("button",{onClick:o,type:"button",className:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})]}),e.jsxs("div",{className:"modal-body",children:["你是否要刪除 ",e.jsxs("span",{className:"text-danger fw-bold",children:[n.title,"?"]})]}),e.jsxs("div",{className:"modal-footer",children:[e.jsx("button",{onClick:o,type:"button",className:"btn btn-secondary",children:"取消"}),e.jsx("button",{onClick:a,type:"button",className:"btn btn-danger",children:"刪除"})]})]})})})}),be=({token:n})=>{const o=L(),a="https://ec-course-api.hexschool.io",t="/product-backend",c={id:"",imageUrl:"",title:"",category:"",unit:"",origin_price:"",price:"",description:"",content:"",is_enabled:0,imagesUrl:[]},[r,x]=O.useState([]),[i,f]=p.useState(c),[j,u]=p.useState("create"),[k,C]=p.useState({total_pages:0,current_page:1}),q=p.useRef(null),U=p.useRef(null);p.useEffect(()=>{n&&(b.defaults.headers.common.Authorization=n)},[n]);const v=p.useCallback(async(h=1)=>{try{const S=await b.get(`${a}/v2/api${t}/admin/products?page=${h}`,{headers:{Authorization:n},withCredentials:!0});x(S.data.products),C(S.data.pagination),o(E("取得產品列表成功"))}catch(S){alert("取得產品失敗"),console.error(S)}},[a,t,n,o]);p.useEffect(()=>{v()},[v]),p.useEffect(()=>{new I(q.current),new I(U.current)},[]);const d=(h,S)=>{u(h),f(S?{id:S.id.toString(),imageUrl:S.imageUrl||"",title:S.title,category:S.category,unit:S.unit,origin_price:S.origin_price.toString(),price:S.price.toString(),description:S.description,content:S.content,is_enabled:S.is_enabled,imagesUrl:S.imagesUrl}:c);const J=I.getInstance(q.current);J&&J.show()},y=h=>{f({id:h.id.toString(),imageUrl:h.imageUrl,title:h.title,category:h.category,unit:"",origin_price:h.origin_price.toString(),price:h.price.toString(),description:h.description,content:h.content,is_enabled:h.is_enabled,imagesUrl:h.imagesUrl});const S=I.getInstance(U.current);S&&S.show()},$=()=>{const h=I.getInstance(q.current);h&&h.hide(),f(c)},_=()=>{const h=I.getInstance(U.current);h&&h.hide(),f(c)},M=async()=>{try{const h=await b.post(`${a}/v2/api${t}/admin/product`,{data:{...i,origin_price:Number(i.origin_price),price:Number(i.price),is_enabled:i.is_enabled?1:0,imagesUrl:Array.isArray(i.imagesUrl)?i.imagesUrl:[],rating:i.rating??0,stock:i.stock??0}});console.log(h.data)}catch(h){console.error(h),alert("新增失敗")}},A=async()=>{try{const h=await b.put(`${a}/v2/api${t}/admin/product/${i.id}`,{data:{...i,origin_price:Number(i.origin_price),price:Number(i.price),is_enabled:i.is_enabled?1:0,imagesUrl:Array.isArray(i.imagesUrl)?i.imagesUrl:[],rating:i.rating??0,stock:i.stock??0}});console.log(h.data)}catch(h){console.error(h),alert("更新失敗")}},F=async()=>{const h=j==="create"?M:A;try{await h(),v(),$()}catch(S){console.error(S),alert("新增失敗")}},s=async()=>{try{const h=await b.delete(`${a}/v2/api${t}/admin/product/${i.id}`,{data:{...i,origin_price:Number(i.origin_price),price:Number(i.price),is_enabled:i.is_enabled?1:0,imagesUrl:Array.isArray(i.imagesUrl)?i.imagesUrl:[]}});console.log(h.data)}catch(h){console.error(h),alert("刪除失敗")}},l=async()=>{try{await s(),v(),_()}catch(h){console.error(h),alert("刪除產品失敗")}},N=h=>{v(h)};return e.jsxs(e.Fragment,{children:[e.jsxs("section",{className:"container mt-5",children:[e.jsx("div",{className:"row",children:e.jsxs("div",{className:"col-12 mb-4",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("h2",{className:"fw-bold",children:"產品列表"}),e.jsxs("button",{onClick:()=>{d("create")},type:"button",className:"btn btn-primary",children:[e.jsx("i",{className:"bi bi-plus-lg"})," 建立新的產品"]})]}),e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"產品名稱"}),e.jsx("th",{children:"原價"}),e.jsx("th",{children:"售價"}),e.jsx("th",{children:"是否啟用"}),e.jsx("th",{children:"查看細節"})]})}),e.jsx("tbody",{children:r.map(h=>e.jsxs("tr",{children:[e.jsx("td",{className:"fw-bold",children:h.title}),e.jsx("td",{children:h.origin_price}),e.jsx("td",{children:h.price}),e.jsx("td",{children:h.is_enabled?e.jsx("span",{className:"text-success",children:"啟用"}):e.jsx("span",{className:"text-danger",children:"未啟用"})}),e.jsx("td",{children:e.jsxs("div",{className:"",children:[e.jsxs("button",{onClick:()=>d("edit",h),type:"button",className:"btn btn-primary btn-sm me-2",children:[e.jsx("i",{className:"bi bi-pencil-square"})," 編輯"]}),e.jsxs("button",{onClick:()=>y(h),type:"button",className:"btn btn-danger btn-sm",children:[e.jsx("i",{className:"bi bi-trash3-fill"})," 刪除"]})]})})]},h.id))})]})]})}),e.jsx("div",{className:"d-flex justify-content-center",children:e.jsx(He,{pageInfo:k,handlePageChange:N})})]}),e.jsx(Re,{tempProduct:i,setTempProduct:f,modalMode:j,closeProductModal:$,handleUploadProduct:F,productModalRef:q,BASE_URL:a,API_PATH:t}),e.jsx(Le,{tempProduct:i,closeDelProductModal:_,handleDelProduct:l,delProductModalRef:U})]})};function Ve(){const n="https://ec-course-api.hexschool.io",o="/product-backend",[a,t]=p.useState(!1);p.useEffect(()=>{const r=async()=>{try{await b.post(`${n}/v2/api/user/check`),t(!0)}catch(i){console.error(i),t(!1)}},x=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1");b.defaults.headers.common.Authorization=x,r()},[]);const c=(r,x)=>{b.post(`${n}/v2/api${o}/admin/signin`,{username:r,password:x}).then(i=>{const{token:f,expired:j}=i.data;document.cookie=`hexToken=${f}; expires=${new Date(j)}`,b.defaults.headers.common.Authorization=f,i.data.success===!0&&(alert("登入成功"),t(!0))}).catch(i=>{console.error(i),alert("登入失敗"),t(!1)})};return e.jsx(e.Fragment,{children:a?e.jsx(be,{isAuth:a}):e.jsx(pe,{handleLogin:c})})}const ee="https://ec-course-api.hexschool.io",se="/product-backend";function De(){var _,M,A,F;const[n,o]=p.useState([]),[a,t]=p.useState({id:"",title:"",imageUrl:"",content:"",description:"",price:0,origin_price:0}),[c,r]=p.useState([]),[x,i]=p.useState(!1),{register:f,handleSubmit:j,formState:{errors:u}}=Y();p.useEffect(()=>{const s=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1");b.defaults.headers.common.Authorization=s,(async()=>{i(!0);try{const N=await b.get(`${ee}/v2/api${se}/products`);o(N.data.products)}catch(N){alert("取得產品失敗"),console.error(N)}finally{i(!1)}})()},[]);const k=p.useRef(null);p.useEffect(()=>{k.current&&new I(k.current,{backdrop:!1})},[]);const C=()=>{const s=I.getInstance(k.current);s&&s.show()},q=()=>{const s=I.getInstance(k.current);s&&s.hide()},U=s=>{t({id:String(s.id),title:s.title,imageUrl:s.imageUrl,content:s.content,description:s.description,price:s.price,origin_price:s.origin_price}),C()},v=async s=>{i(!0);try{await b.post(`${ee}/v2/api${se}/cart`,{data:{product_id:s.id,qty:1}}),r(l=>l.find(h=>h.id===s.id)?l.map(h=>h.id===s.id?{...h,quantity:h.quantity+1}:h):[...l,{...s,quantity:1}]),alert("已加入購物車")}catch(l){console.error(l),alert("加入購物車失敗")}finally{i(!1)}},d=async s=>{if(c.length===0){alert("購物車無產品，無法結帳");return}try{await b.post(`${ee}/v2/api${se}/order`,{data:{user:{name:s.name,email:s.email,tel:s.tel,address:s.address},message:s.message}}),r([]),alert("訂單已送出並清空購物車")}catch(l){console.error(l),alert("訂單發送失敗")}},[y,$]=p.useState(1);return e.jsxs("div",{className:"container",children:[x&&e.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:"rgba(255, 255, 255, 0.5)"},children:e.jsx(Q,{type:"spin",color:"#000"})}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("table",{className:"table align-middle",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"圖片"}),e.jsx("th",{children:"商品名稱"}),e.jsx("th",{children:"價格"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:n.map(s=>e.jsxs("tr",{children:[e.jsx("td",{style:{width:"200px"},children:e.jsx("img",{className:"img-fluid",src:s.imageUrl,alt:s.title})}),e.jsx("td",{children:s.title}),e.jsxs("td",{children:[e.jsxs("del",{className:"h6",children:["原價 ",s.origin_price," 元"]}),e.jsxs("div",{className:"h5",children:["特價 ",s.origin_price,"元"]})]}),e.jsx("td",{children:e.jsxs("div",{className:"btn-group btn-group-sm",children:[e.jsx("button",{onClick:()=>U(s),type:"button",className:"btn btn-outline-secondary",children:"查看更多"}),e.jsx("button",{onClick:()=>v(s),type:"button",className:"btn btn-outline-danger",children:"加到購物車"})]})})]},s.id))})]}),e.jsx("div",{ref:k,style:{backgroundColor:"rgba(0,0,0,0.5)"},className:"modal fade",id:"productModal",tabIndex:-1,children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h2",{className:"modal-title fs-5",children:["產品名稱：",a.title]}),e.jsx("button",{onClick:q,type:"button",className:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})]}),e.jsxs("div",{className:"modal-body",children:[e.jsx("img",{src:a.imageUrl,alt:a.title,className:"img-fluid"}),e.jsxs("p",{children:["內容：",a.content]}),e.jsxs("p",{children:["描述：",a.description]}),e.jsxs("p",{children:["價錢：",a.price," ",e.jsx("del",{children:a.origin_price})," 元"]}),e.jsxs("div",{className:"input-group align-items-center",children:[e.jsx("label",{htmlFor:"qtySelect",children:"數量："}),e.jsx("select",{value:y,onChange:s=>$(Number(s.target.value)),id:"qtySelect",className:"form-select",children:Array.from({length:10}).map((s,l)=>e.jsx("option",{value:l+1,children:l+1},l))})]})]}),e.jsx("div",{className:"modal-footer",children:e.jsx("button",{type:"button",className:"btn btn-primary",onClick:()=>a.id&&v(a),disabled:!a.id,children:"加入購物車"})})]})})}),e.jsx("div",{className:"text-end py-3",children:e.jsx("button",{className:"btn btn-outline-danger",type:"button",onClick:()=>r([]),children:"清空購物車"})}),e.jsxs("table",{className:"table align-middle",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{}),e.jsx("th",{children:"品名"}),e.jsx("th",{style:{width:"150px"},children:"數量/單位"}),e.jsx("th",{className:"text-end",children:"單價"})]})}),e.jsx("tbody",{children:c.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>r(l=>l.filter(N=>N.id!==s.id)),children:"x"})}),e.jsx("td",{children:s.title}),e.jsx("td",{style:{width:"150px"},children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsxs("div",{className:"btn-group me-2",role:"group",children:[e.jsx("button",{type:"button",className:"btn btn-outline-dark btn-sm",onClick:()=>r(l=>l.map(N=>N.id===s.id&&N.quantity>1?{...N,quantity:N.quantity-1}:N)),children:"-"}),e.jsx("span",{className:"btn border border-dark",style:{width:"50px",cursor:"auto"},children:s.quantity}),e.jsx("button",{type:"button",className:"btn btn-outline-dark btn-sm",onClick:()=>r(l=>l.map(N=>N.id===s.id?{...N,quantity:N.quantity+1}:N)),children:"+"})]}),e.jsx("span",{className:"input-group-text bg-transparent border-0",children:"unit"})]})}),e.jsx("td",{className:"text-end",children:s.price*s.quantity})]},s.id))}),e.jsx("tfoot",{children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:3,className:"text-end",children:"總計："}),e.jsx("td",{className:"text-end",style:{width:"130px"},children:c.reduce((s,l)=>s+l.price*l.quantity,0)})]})})]})]}),e.jsx("div",{className:"my-5 row justify-content-center",children:e.jsxs("form",{className:"col-md-6",onSubmit:j(d),children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"email",className:"form-label",children:"Email"}),e.jsx("input",{id:"email",type:"email",className:"form-control",placeholder:"請輸入 Email",...f("email",{required:"必填"})}),e.jsx("p",{className:"text-danger my-2",children:(_=u.email)==null?void 0:_.message})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"name",className:"form-label",children:"收件人姓名"}),e.jsx("input",{id:"name",className:"form-control",placeholder:"請輸入姓名",...f("name",{required:"必填"})}),e.jsx("p",{className:"text-danger my-2",children:(M=u.name)==null?void 0:M.message})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"tel",className:"form-label",children:"收件人電話"}),e.jsx("input",{id:"tel",type:"text",className:"form-control",placeholder:"請輸入電話",...f("tel",{required:"必填",pattern:{value:/^(0[2-8]\d{7}|09\d{8})$/,message:"請輸入正確的電話格式"}})}),e.jsx("p",{className:"text-danger my-2",children:(A=u.tel)==null?void 0:A.message})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"address",className:"form-label",children:"收件人地址"}),e.jsx("input",{id:"address",type:"text",className:"form-control",placeholder:"請輸入地址",...f("address",{required:"必填"})}),e.jsx("p",{className:"text-danger my-2",children:(F=u.address)==null?void 0:F.message})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"message",className:"form-label",children:"留言"}),e.jsx("textarea",{id:"message",className:"form-control",cols:30,rows:10,...f("message")})]}),e.jsx("div",{className:"text-end",children:e.jsx("button",{type:"submit",className:"btn btn-danger",children:"送出訂單"})})]})})]})}const V=({isAuth:n,onLogout:o})=>{const a=async()=>{try{await b.post("https://ec-course-api.hexschool.io/v2/logout",{},{withCredentials:!0}),document.cookie="hexToken=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;",b.defaults.headers.common.Authorization="",o&&o(),alert("登出成功")}catch(t){console.error("登出失敗",t),alert("登出失敗")}};return e.jsx("nav",{className:"container navbar navbar-expand-lg navbar-dark bg-dark",children:e.jsxs("div",{className:"container-fluid",children:[e.jsx(P,{className:"navbar-brand",to:"/",children:"CART"}),e.jsx("button",{className:"navbar-toggler",type:"button","data-bs-toggle":"collapse","data-bs-target":"#navbarNav","aria-controls":"navbarNav","aria-expanded":"false","aria-label":"Toggle navigation",children:e.jsx("span",{className:"navbar-toggler-icon"})}),e.jsx("div",{className:"collapse navbar-collapse",id:"navbarNav",children:e.jsxs("ul",{className:"navbar-nav",children:[e.jsx("li",{className:"nav-item",children:e.jsx(K,{className:({isActive:t})=>t?"nav-link active":"nav-link",to:"/",children:"首頁"})}),e.jsx("li",{className:"nav-item",children:e.jsx(K,{className:({isActive:t})=>t?"nav-link active":"nav-link",to:"/products",children:"產品頁"})}),e.jsx("li",{className:"nav-item",children:e.jsx(K,{className:({isActive:t})=>t?"nav-link active":"nav-link",to:"/cart",children:"購物車"})}),e.jsx("li",{className:"nav-item",children:e.jsx(K,{className:({isActive:t})=>t?"nav-link active":"nav-link",to:"/Admin",children:"後台登入"})}),n&&e.jsx("li",{className:"nav-item",children:e.jsx("button",{className:"nav-link btn btn-link",onClick:a,children:"登出"})})]})})]})})},ae="https://ec-course-api.hexschool.io",te="/product-backend";function ze(){var _,M,A,F;const[n,o]=p.useState([]),[a,t]=p.useState({title:"",imageUrl:"",content:"",description:"",price:0,origin_price:0}),[c,r]=p.useState([]),[x,i]=p.useState(!1),{register:f,handleSubmit:j,formState:{errors:u}}=Y();p.useEffect(()=>{const s=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1");b.defaults.headers.common.Authorization=s,(async()=>{i(!0);try{const N=await b.get(`${ae}/v2/api${te}/products`);o(N.data.products)}catch(N){alert("取得產品失敗"),console.error(N)}finally{i(!1)}})()},[]);const k=p.useRef(null);p.useEffect(()=>{k.current&&new I(k.current,{backdrop:!1})},[]);const C=()=>{const s=I.getInstance(k.current);s&&s.show()},q=()=>{const s=I.getInstance(k.current);s&&s.hide()},U=s=>{t(s),C()},v=async s=>{i(!0);try{await b.post(`${ae}/v2/api${te}/cart`,{data:{product_id:s.id,qty:1}}),r(l=>l.find(h=>h.id===s.id)?l.map(h=>h.id===s.id?{...h,quantity:h.quantity+1}:h):[...l,{...s,quantity:1}]),alert("已加入購物車")}catch(l){console.error(l),alert("加入購物車失敗")}finally{i(!1)}},d=async s=>{if(c.length===0){alert("購物車無產品，無法結帳");return}try{await b.post(`${ae}/v2/api${te}/order`,{data:{user:{name:s.name,email:s.email,tel:s.tel,address:s.address},message:s.message}}),r([]),alert("訂單已送出並清空購物車")}catch(l){console.error(l),alert("訂單發送失敗")}},[y,$]=p.useState(1);return e.jsxs(e.Fragment,{children:[e.jsx(V,{})," ",e.jsxs("div",{className:"container",children:[x&&e.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:"rgba(255, 255, 255, 0.5)"},children:e.jsx(Q,{type:"spin",color:"#000"})}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("table",{className:"table align-middle",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"圖片"}),e.jsx("th",{children:"商品名稱"}),e.jsx("th",{children:"價格"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:n.map(s=>e.jsxs("tr",{children:[e.jsx("td",{style:{width:"200px"},children:e.jsx("img",{className:"img-fluid",src:s.imageUrl,alt:s.title})}),e.jsx("td",{children:s.title}),e.jsxs("td",{children:[e.jsxs("del",{className:"h6",children:["原價 ",s.origin_price," 元"]}),e.jsxs("div",{className:"h5",children:["特價 ",s.origin_price,"元"]})]}),e.jsx("td",{children:e.jsxs("div",{className:"btn-group btn-group-sm",children:[e.jsx("button",{onClick:()=>U(s),type:"button",className:"btn btn-outline-secondary",children:"查看更多"}),e.jsx("button",{onClick:()=>v(s),type:"button",className:"btn btn-outline-danger",children:"加到購物車"})]})})]},s.id))})]}),e.jsx("div",{ref:k,style:{backgroundColor:"rgba(0,0,0,0.5)"},className:"modal fade",id:"productModal",tabIndex:-1,children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h2",{className:"modal-title fs-5",children:["產品名稱：",a.title]}),e.jsx("button",{onClick:q,type:"button",className:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})]}),e.jsxs("div",{className:"modal-body",children:[e.jsx("img",{src:a.imageUrl,alt:a.title,className:"img-fluid"}),e.jsxs("p",{children:["內容：",a.content]}),e.jsxs("p",{children:["描述：",a.description]}),e.jsxs("p",{children:["價錢：",a.price," ",e.jsx("del",{children:a.origin_price})," 元"]}),e.jsxs("div",{className:"input-group align-items-center",children:[e.jsx("label",{htmlFor:"qtySelect",children:"數量："}),e.jsx("select",{value:y,onChange:s=>$(Number(s.target.value)),id:"qtySelect",className:"form-select",children:Array.from({length:10}).map((s,l)=>e.jsx("option",{value:l+1,children:l+1},l))})]})]}),e.jsx("div",{className:"modal-footer",children:e.jsx("button",{type:"button",className:"btn btn-primary",children:"加入購物車"})})]})})}),e.jsx("div",{className:"text-end py-3",children:e.jsx("button",{className:"btn btn-outline-danger",type:"button",onClick:()=>r([]),children:"清空購物車"})}),e.jsxs("table",{className:"table align-middle",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{}),e.jsx("th",{children:"品名"}),e.jsx("th",{style:{width:"150px"},children:"數量/單位"}),e.jsx("th",{className:"text-end",children:"單價"})]})}),e.jsx("tbody",{children:c.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>r(l=>l.filter(N=>N.id!==s.id)),children:"x"})}),e.jsx("td",{children:s.title}),e.jsx("td",{style:{width:"150px"},children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsxs("div",{className:"btn-group me-2",role:"group",children:[e.jsx("button",{type:"button",className:"btn btn-outline-dark btn-sm",onClick:()=>r(l=>l.map(N=>N.id===s.id&&N.quantity>1?{...N,quantity:N.quantity-1}:N)),children:"-"}),e.jsx("span",{className:"btn border border-dark",style:{width:"50px",cursor:"auto"},children:s.quantity}),e.jsx("button",{type:"button",className:"btn btn-outline-dark btn-sm",onClick:()=>r(l=>l.map(N=>N.id===s.id?{...N,quantity:N.quantity+1}:N)),children:"+"})]}),e.jsx("span",{className:"input-group-text bg-transparent border-0",children:"unit"})]})}),e.jsx("td",{className:"text-end",children:s.price*s.quantity})]},s.id))}),e.jsx("tfoot",{children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:3,className:"text-end",children:"總計："}),e.jsx("td",{className:"text-end",style:{width:"130px"},children:c.reduce((s,l)=>s+l.price*l.quantity,0)})]})})]})]}),e.jsx("div",{className:"my-5 row justify-content-center",children:e.jsxs("form",{className:"col-md-6",onSubmit:j(d),children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"email",className:"form-label",children:"Email"}),e.jsx("input",{id:"email",type:"email",className:"form-control",placeholder:"請輸入 Email",...f("email",{required:"必填"})}),e.jsx("p",{className:"text-danger my-2",children:(_=u.email)==null?void 0:_.message})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"name",className:"form-label",children:"收件人姓名"}),e.jsx("input",{id:"name",className:"form-control",placeholder:"請輸入姓名",...f("name",{required:"必填"})}),e.jsx("p",{className:"text-danger my-2",children:(M=u.name)==null?void 0:M.message})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"tel",className:"form-label",children:"收件人電話"}),e.jsx("input",{id:"tel",type:"text",className:"form-control",placeholder:"請輸入電話",...f("tel",{required:"必填",pattern:{value:/^(0[2-8]\d{7}|09\d{8})$/,message:"請輸入正確的電話格式"}})}),e.jsx("p",{className:"text-danger my-2",children:(A=u.tel)==null?void 0:A.message})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"address",className:"form-label",children:"收件人地址"}),e.jsx("input",{id:"address",type:"text",className:"form-control",placeholder:"請輸入地址",...f("address",{required:"必填"})}),e.jsx("p",{className:"text-danger my-2",children:(F=u.address)==null?void 0:F.message})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"message",className:"form-label",children:"留言"}),e.jsx("textarea",{id:"message",className:"form-control",cols:30,rows:10,...f("message")})]}),e.jsx("div",{className:"text-end",children:e.jsx("button",{type:"submit",className:"btn btn-danger",children:"送出訂單"})})]})})]})]})}const Z="https://ec-course-api.hexschool.io",X="/product-backend";function Be(){var M,A,F,s;const[n,o]=p.useState([]),[a,t]=p.useState({id:"",title:"",imageUrl:"",content:"",description:"",price:0,origin_price:0}),[c,r]=p.useState(!1),{register:x,handleSubmit:i,formState:{errors:f}}=Y(),j=L(),u=re(l=>l.cart);p.useEffect(()=>{const l=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1");b.defaults.headers.common.Authorization=l,(async()=>{r(!0);try{const h=await b.get(`${Z}/v2/api${X}/products`);o(h.data.products)}catch(h){alert("取得產品失敗"),console.error(h)}finally{r(!1)}})()},[]);const k=p.useRef(null);p.useEffect(()=>{k.current&&new I(k.current,{backdrop:!1})},[]);const C=()=>{const l=I.getInstance(k.current);l&&l.show()},q=()=>{const l=I.getInstance(k.current);l&&l.hide()},U=l=>{t(l),C()},v=async l=>{r(!0);try{await b.post(`${Z}/v2/api${X}/cart`,{data:{product_id:l.id,qty:1}}),j(B({product:l,quantity:1})),j(E("已加入購物車"))}catch(N){console.error(N),alert("加入購物車失敗")}finally{r(!1)}},d=async()=>{r(!0);try{await b.post(`${Z}/v2/api${X}/cart`,{data:{product_id:a.id,qty:$}}),j(B({product:a,quantity:$})),j(E(`已加入 ${$} 個 ${a.title} 至購物車`)),q()}catch(l){console.error(l),alert("加入購物車失敗")}finally{r(!1)}},y=async l=>{if(u.length===0){alert("購物車無產品，無法結帳");return}try{await b.post(`${Z}/v2/api${X}/order`,{data:{user:{name:l.name,email:l.email,tel:l.tel,address:l.address},message:l.message}}),j(W()),j(E("訂單已送出並清空購物車"))}catch(N){console.error(N),alert("訂單發送失敗")}},[$,_]=p.useState(1);return e.jsxs(e.Fragment,{children:[e.jsx(V,{}),e.jsx(G,{}),e.jsxs("div",{className:"container",children:[c&&e.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:"rgba(255, 255, 255, 0.5)"},children:e.jsx(Q,{type:"spin",color:"#000"})}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("table",{className:"table align-middle",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"圖片"}),e.jsx("th",{children:"商品名稱"}),e.jsx("th",{children:"價格"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:n.map(l=>e.jsxs("tr",{children:[e.jsx("td",{style:{width:"200px"},children:e.jsx("img",{className:"img-fluid",src:l.imageUrl,alt:l.title})}),e.jsx("td",{children:l.title}),e.jsxs("td",{children:[e.jsxs("del",{className:"h6",children:["原價 ",l.origin_price," 元"]}),e.jsxs("div",{className:"h5",children:["特價 ",l.origin_price,"元"]})]}),e.jsx("td",{children:e.jsxs("div",{className:"btn-group btn-group-sm",children:[e.jsx("button",{onClick:()=>U(l),type:"button",className:"btn btn-outline-secondary",children:"查看更多"}),e.jsx("button",{onClick:()=>v(l),type:"button",className:"btn btn-outline-danger",children:"加到購物車"})]})})]},l.id))})]}),e.jsx("div",{ref:k,style:{backgroundColor:"rgba(0,0,0,0.5)"},className:"modal fade",id:"productModal",tabIndex:-1,children:e.jsx("div",{className:"modal-dialog modal-dialog-centered",children:e.jsxs("div",{className:"modal-content",children:[e.jsxs("div",{className:"modal-header",children:[e.jsxs("h2",{className:"modal-title fs-5",children:["產品名稱：",a.title]}),e.jsx("button",{onClick:q,type:"button",className:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})]}),e.jsxs("div",{className:"modal-body",children:[e.jsx("img",{src:a.imageUrl,alt:a.title,className:"img-fluid"}),e.jsxs("p",{children:["內容：",a.content]}),e.jsxs("p",{children:["描述：",a.description]}),e.jsxs("p",{children:["價錢：",a.price," ",e.jsx("del",{children:a.origin_price})," 元"]}),e.jsxs("div",{className:"input-group align-items-center",children:[e.jsx("label",{htmlFor:"qtySelect",children:"數量："}),e.jsx("select",{value:$,onChange:l=>_(Number(l.target.value)),id:"qtySelect",className:"form-select",children:Array.from({length:10}).map((l,N)=>e.jsx("option",{value:N+1,children:N+1},N))})]})]}),e.jsx("div",{className:"modal-footer",children:e.jsx("button",{type:"button",className:"btn btn-primary",onClick:d,children:"加入購物車"})})]})})}),e.jsx("div",{className:"text-end py-3",children:e.jsx("button",{className:"btn btn-outline-danger",type:"button",onClick:()=>j(W()),children:"清空購物車"})}),e.jsxs("table",{className:"table align-middle",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{}),e.jsx("th",{children:"品名"}),e.jsx("th",{style:{width:"150px"},children:"數量/單位"}),e.jsx("th",{className:"text-end",children:"單價"})]})}),e.jsx("tbody",{children:u.map(l=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>j(W()),children:"x"})}),e.jsx("td",{children:l.title}),e.jsx("td",{style:{width:"150px"},children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsxs("div",{className:"btn-group me-2",role:"group",children:[e.jsx("button",{type:"button",className:"btn btn-outline-dark btn-sm",onClick:()=>j(B({product:l,quantity:l.quantity-1})),children:"-"}),e.jsx("span",{className:"btn border border-dark",style:{width:"50px",cursor:"auto"},children:l.quantity}),e.jsx("button",{type:"button",className:"btn btn-outline-dark btn-sm",onClick:()=>j(B({product:l,quantity:l.quantity+1})),children:"+"})]}),e.jsx("span",{className:"input-group-text bg-transparent border-0",children:"unit"})]})}),e.jsx("td",{className:"text-end",children:l.price*l.quantity})]},l.id))}),e.jsx("tfoot",{children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:3,className:"text-end",children:"總計："}),e.jsx("td",{className:"text-end",style:{width:"130px"},children:u.reduce((l,N)=>l+N.price*N.quantity,0)})]})})]})]}),e.jsx("div",{className:"my-5 row justify-content-center",children:e.jsxs("form",{className:"col-md-6",onSubmit:i(y),children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"email",className:"form-label",children:"Email"}),e.jsx("input",{id:"email",type:"email",className:"form-control",placeholder:"請輸入 Email",...x("email",{required:"必填"})}),e.jsx("p",{className:"text-danger my-2",children:(M=f.email)==null?void 0:M.message})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"name",className:"form-label",children:"收件人姓名"}),e.jsx("input",{id:"name",className:"form-control",placeholder:"請輸入姓名",...x("name",{required:"必填"})}),e.jsx("p",{className:"text-danger my-2",children:(A=f.name)==null?void 0:A.message})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"tel",className:"form-label",children:"收件人電話"}),e.jsx("input",{id:"tel",type:"text",className:"form-control",placeholder:"請輸入電話",...x("tel",{required:"必填",pattern:{value:/^(0[2-8]\d{7}|09\d{8})$/,message:"請輸入正確的電話格式"}})}),e.jsx("p",{className:"text-danger my-2",children:(F=f.tel)==null?void 0:F.message})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"address",className:"form-label",children:"收件人地址"}),e.jsx("input",{id:"address",type:"text",className:"form-control",placeholder:"請輸入地址",...x("address",{required:"必填"})}),e.jsx("p",{className:"text-danger my-2",children:(s=f.address)==null?void 0:s.message})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"message",className:"form-label",children:"留言"}),e.jsx("textarea",{id:"message",className:"form-control",cols:30,rows:10,...x("message")})]}),e.jsx("div",{className:"text-end",children:e.jsx("button",{type:"submit",className:"btn btn-danger",children:"送出訂單"})})]})})]})]})}const le="https://ec-course-api.hexschool.io",ne="/product-backend",We=({cart:n,setCart:o})=>{const[a,t]=p.useState([]),[c,r]=p.useState(!1),x=L();p.useEffect(()=>{(async()=>{r(!0);try{const u=await b.get(`${le}/v2/api${ne}/products`);t(u.data.products)}catch(u){alert("取得產品失敗"),console.error(u)}finally{r(!1)}})()},[]);const i=async j=>{r(!0);try{await b.post(`${le}/v2/api${ne}/cart`,{data:{product_id:j.id,qty:1}}),o(u=>u.find(C=>C.id===j.id)?u.map(C=>C.id===j.id?{...C,quantity:C.quantity+1}:C):[...u,{...j,quantity:1}]),x(E("已加入購物車"))}catch(u){console.error(u),alert("加入購物車失敗")}finally{r(!1)}},f=async j=>{r(!0);try{await b.delete(`${le}/v2/api${ne}/cart/${j}`),o(u=>u.filter(k=>k.id!==j)),x(E("已從購物車移除產品"))}catch(u){console.error(u),alert("從購物車移除產品失敗")}finally{r(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(V,{}),e.jsx(G,{}),e.jsxs("div",{className:"container mt-4",children:[c&&e.jsx(Q,{type:"spin",color:"#000",className:"d-block mx-auto"}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("h1",{children:"產品列表"}),e.jsx(P,{to:"/cart",className:"btn btn-primary mt-3",children:"查看購物車"})]}),e.jsxs("table",{className:"table align-middle",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"圖片"}),e.jsx("th",{children:"商品名稱"}),e.jsx("th",{children:"價格"}),e.jsx("th",{})]})}),e.jsx("tbody",{children:a.map(j=>e.jsxs("tr",{children:[e.jsx("td",{style:{width:"200px"},children:e.jsx("img",{className:"img-fluid",src:j.imageUrl,alt:j.title})}),e.jsx("td",{children:j.title}),e.jsxs("td",{children:[e.jsxs("del",{className:"h6",children:["原價 ",j.origin_price," 元"]}),e.jsxs("div",{className:"h5",children:["特價 ",j.price," 元"]})]}),e.jsx("td",{children:e.jsxs("div",{className:"btn-group btn-group-sm",children:[e.jsx(P,{to:`/products/${j.id}`,className:"btn btn-outline-secondary",children:"查看更多"}),e.jsx("button",{onClick:()=>i(j),type:"button",className:"btn btn-outline-danger",children:"加到購物車"})]})})]},j.id))})]}),n.length>0&&e.jsxs("div",{className:"mt-5",children:[e.jsx("h2",{children:"購物車"}),e.jsxs("table",{className:"table align-middle",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{}),e.jsx("th",{children:"品名"}),e.jsx("th",{children:"數量"}),e.jsx("th",{className:"text-end",children:"單價"}),e.jsx("th",{className:"text-end",children:"小計"})]})}),e.jsx("tbody",{children:n.map(j=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("button",{type:"button",className:"btn btn-outline-danger btn-sm",onClick:()=>f(j.id),children:"x"})}),e.jsx("td",{children:j.title}),e.jsx("td",{children:j.quantity}),e.jsx("td",{className:"text-end",children:j.price}),e.jsx("td",{className:"text-end",children:j.price*j.quantity})]},j.id))}),e.jsx("tfoot",{children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:4,className:"text-end",children:"總計："}),e.jsx("td",{className:"text-end",children:n.reduce((j,u)=>j+u.price*u.quantity,0)})]})})]}),e.jsx("div",{className:"text-end",children:e.jsx("button",{className:"btn btn-danger",onClick:()=>{o([]),x(E("購物車已清空"))},children:"清空購物車"})})]})]})]})},me="https://ec-course-api.hexschool.io",he="/product-backend",Oe=()=>{const{id:n}=we(),o=Ce(),[a,t]=p.useState(null),[c,r]=p.useState(!1),x=L();p.useEffect(()=>{(async()=>{r(!0);try{const j=await b.get(`${me}/v2/api${he}/product/${n}`);t(j.data.product)}catch(j){alert("取得產品詳情失敗"),console.error(j)}finally{r(!1)}})()},[n]);const i=async()=>{if(a){r(!0);try{await b.post(`${me}/v2/api${he}/cart`,{data:{product_id:a.id,qty:1}}),x(B({product:{id:a.id,title:a.title,imageUrl:a.imageUrl,price:a.price,origin_price:a.origin_price},quantity:1})),x(E("已加入購物車"))}catch(f){console.error("加入購物車失敗",f),alert("加入購物車失敗")}finally{r(!1)}}};return c?e.jsx("div",{className:"d-flex justify-content-center align-items-center vh-100",children:e.jsx(Q,{type:"spin",color:"#000"})}):a?e.jsxs(e.Fragment,{children:[e.jsx(V,{}),e.jsxs("div",{className:"container mt-4",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("h1",{children:"產品詳細頁"}),e.jsx("button",{className:"btn btn-danger",onClick:i,children:"加到購物車"})]}),e.jsx("img",{src:a.imageUrl,alt:a.title,className:"img-fluid mb-3"}),e.jsx("h2",{children:a.title}),e.jsx("p",{children:a.content}),e.jsx("p",{children:a.description}),e.jsxs("p",{children:["價格：",a.price," 元 ",e.jsxs("del",{children:[a.origin_price," 元"]})]}),e.jsx("button",{className:"btn btn-outline-primary",onClick:()=>o("/products"),children:"返回產品列表"})]})]}):e.jsx("h1",{className:"text-center mt-5",children:"找不到產品"})},D="https://ec-course-api.hexschool.io",z="/product-backend",Qe=()=>{var C,q,U,v;const{register:n,handleSubmit:o,formState:{errors:a}}=Y(),[t,c]=p.useState(!1),r=re(d=>d.cart),x=L(),i=r.reduce((d,y)=>d+y.price*y.quantity,0),f=async d=>{if(r.length===0){x(E("購物車是空的，無法送出訂單！"));return}c(!0);try{await b.post(`${D}/v2/api${z}/order`,{data:{user:{name:d.name,email:d.email,tel:d.tel,address:d.address},message:d.message,products:r.map(y=>({product_id:y.id,qty:y.quantity}))}}),alert("訂單送出成功！"),x(W()),window.location.reload()}catch(y){console.error("訂單送出失敗",y),alert("訂單送出失敗，請稍後再試！")}finally{c(!1)}},j=async d=>{c(!0);try{await b.delete(`${D}/v2/api${z}/cart/${d}`),x(oe(d)),x(E("已從購物車移除商品"))}catch(y){console.error("刪除購物車商品失敗",y),x(E("刪除購物車商品失敗，請稍後再試"))}finally{c(!1)}},u=async d=>{c(!0);try{if(d.quantity>1){const y=d.quantity-1;await b.post(`${D}/v2/api${z}/cart`,{data:{product_id:d.id,qty:y}}),x(de({id:d.id,quantity:y})),x(E(`已減少 1 個 ${d.title}`))}else await b.delete(`${D}/v2/api${z}/cart/${d.id}`),x(oe(d.id)),x(E(`已從購物車移除 ${d.title}`))}catch(y){console.error("更新購物車失敗",y),x(E("更新購物車失敗，請稍後再試"))}finally{c(!1)}},k=async d=>{c(!0);try{const y=d.quantity+1;await b.post(`${D}/v2/api${z}/cart`,{data:{product_id:d.id,qty:y}}),x(de({id:d.id,quantity:y})),x(E(`已增加 1 個 ${d.title}`))}catch(y){console.error("更新購物車失敗",y),x(E("更新購物車失敗，請稍後再試"))}finally{c(!1)}};return e.jsxs(e.Fragment,{children:[e.jsx(V,{}),e.jsx(G,{}),e.jsxs("div",{className:"container mt-4",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("h1",{children:"購物車"}),e.jsx(P,{to:"/products",className:"btn btn-outline-primary mt-3",children:"返回產品列表"})]}),r.length===0?e.jsxs("div",{className:"text-center mt-5",children:[e.jsx("div",{className:"text-danger col-12",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"#000000",width:"80px",height:"80px",viewBox:"0 0 22 22",id:"memory-cart",children:e.jsx("path",{d:"M19 14V16H6V15H5V11H4V8H3V3H1V1H5V4H21V8H20V11H19V12H7V14H19M5 7H6V10H18V7H19V6H5V7M7 17H9V18H10V20H9V21H7V20H6V18H7V17M15 17H17V18H18V20H17V21H15V20H14V18H15V17Z"})})}),e.jsx("h2",{className:"text-muted mt-3",children:"您的購物車是空的"}),e.jsx("p",{className:"text-muted",children:"趕快去選購您喜愛的商品吧！"}),e.jsx(P,{to:"/products",className:"btn btn-primary mt-3",children:"返回產品列表"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("table",{className:"table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"品名"}),e.jsx("th",{children:"數量"}),e.jsx("th",{children:"單價"}),e.jsx("th",{children:"總價"}),e.jsx("th",{children:"操作"})]})}),e.jsx("tbody",{children:r.map(d=>e.jsxs("tr",{children:[e.jsx("td",{children:d.title}),e.jsxs("td",{children:[e.jsx("button",{className:"btn btn-outline-secondary btn-sm me-2",onClick:()=>u(d),children:"-"}),d.quantity,e.jsx("button",{className:"btn btn-outline-secondary btn-sm ms-2",onClick:()=>k(d),children:"+"})]}),e.jsxs("td",{children:[d.price," 元"]}),e.jsxs("td",{children:[d.price*d.quantity," 元"]}),e.jsx("td",{children:e.jsx("button",{className:"btn btn-outline-danger btn-sm",onClick:()=>j(d.id),children:"移除"})})]},d.id))}),e.jsx("tfoot",{children:e.jsxs("tr",{children:[e.jsx("td",{colSpan:3,className:"text-end fw-bold",children:"總計："}),e.jsxs("td",{className:"fw-bold",children:[i," 元"]})]})})]}),e.jsx("div",{className:"my-5 row justify-content-center",children:e.jsxs("form",{className:"col-md-6",onSubmit:o(f),children:[e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"email",className:"form-label",children:"Email"}),e.jsx("input",{id:"email",type:"email",className:"form-control",placeholder:"請輸入 Email",...n("email",{required:"必填"})}),e.jsx("p",{className:"text-danger my-2",children:(C=a.email)==null?void 0:C.message})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"name",className:"form-label",children:"收件人姓名"}),e.jsx("input",{id:"name",className:"form-control",placeholder:"請輸入姓名",...n("name",{required:"必填"})}),e.jsx("p",{className:"text-danger my-2",children:(q=a.name)==null?void 0:q.message})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"tel",className:"form-label",children:"收件人電話"}),e.jsx("input",{id:"tel",type:"text",className:"form-control",placeholder:"請輸入電話",...n("tel",{required:"必填",pattern:{value:/^(0[2-8]\d{7}|09\d{8})$/,message:"請輸入正確的電話格式"}})}),e.jsx("p",{className:"text-danger my-2",children:(U=a.tel)==null?void 0:U.message})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"address",className:"form-label",children:"收件人地址"}),e.jsx("input",{id:"address",type:"text",className:"form-control",placeholder:"請輸入地址",...n("address",{required:"必填"})}),e.jsx("p",{className:"text-danger my-2",children:(v=a.address)==null?void 0:v.message})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{htmlFor:"message",className:"form-label",children:"留言"}),e.jsx("textarea",{id:"message",className:"form-control",cols:30,rows:3,...n("message")})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("button",{type:"submit",className:"btn btn-danger",disabled:t,children:t?"送出中...":"送出訂單"}),e.jsx("button",{type:"button",className:"btn btn-outline-secondary ms-2",onClick:()=>{x(W()),window.location.reload()},children:"清空購物車"})]})]})})]})]})]})};b.defaults.withCredentials=!0;function Ge(){const n="https://ec-course-api.hexschool.io",[o,a]=p.useState(!1);p.useEffect(()=>{const c=async()=>{try{await b.post(`${n}/v2/api/user/check`),a(!0)}catch(x){console.error(x),a(!1)}},r=document.cookie.replace(/(?:(?:^|.*;\s*)hexToken\s*=\s*([^;]*).*$)|^.*$/,"$1");b.defaults.headers.common.Authorization=r,c()},[n]);const t=(c,r)=>{b.post(`${n}/v2/admin/signin`,{username:c,password:r}).then(x=>{const{token:i,expired:f}=x.data;document.cookie=`hexToken=${i}; expires=${new Date(f)}; path=/; SameSite=None; Secure`,b.defaults.headers.common.Authorization=i,x.data.success===!0&&(alert("登入成功"),a(!0))}).catch(x=>{console.error(x),alert("登入失敗"),a(!1)})};return e.jsxs(e.Fragment,{children:[e.jsx(V,{isAuth:o,onLogout:()=>a(!1)}),e.jsx(G,{}),o?e.jsx(be,{isAuth:o,token:b.defaults.headers.common.Authorization||void 0}):e.jsx(pe,{handleLogin:t})]})}const Je=()=>e.jsx($e,{children:e.jsx(Ue,{children:e.jsxs(R,{path:"/",element:e.jsx(Me,{}),children:[e.jsx(R,{index:!0,element:e.jsx(Ee,{})}),e.jsx(R,{path:"week2",element:e.jsx(Pe,{})}),e.jsx(R,{path:"week3",element:e.jsx(Te,{})}),e.jsx(R,{path:"week4",element:e.jsx(Ve,{})}),e.jsx(R,{path:"week5",element:e.jsx(De,{})}),e.jsx(R,{path:"week6",element:e.jsx(ze,{})}),e.jsx(R,{path:"week7",element:e.jsx(Be,{})}),e.jsx(R,{path:"products",element:e.jsx(We,{cart:[],setCart:()=>{}})}),e.jsx(R,{path:"products/:id",element:e.jsx(Oe,{})}),e.jsx(R,{path:"cart",element:e.jsx(Qe,{})}),e.jsx(R,{path:"admin",element:e.jsx(Ge,{})})]})})});_e.createRoot(document.getElementById("root")).render(e.jsx(O.StrictMode,{children:e.jsx(Se,{store:Ie,children:e.jsx(Je,{})})}));
//# sourceMappingURL=index-D5dzyXFz.js.map
